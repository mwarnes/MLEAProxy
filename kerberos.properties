# ================================================================
# Kerberos KDC Configuration for MLEAProxy
# ================================================================
# This file configures the embedded Apache Kerby KDC (Key Distribution Center)
# for testing and development purposes.
#
# The KDC provides Kerberos authentication without requiring external
# Active Directory or MIT Kerberos infrastructure.
#
# Related Documentation:
#   - KERBEROS_FEASIBILITY.md - Technical design and architecture
#   - KERBEROS_GUIDE.md - User guide (to be created in Phase 1)
#
# Last Updated: October 6, 2025
# ================================================================

# ================================================================
# Enable/Disable Kerberos KDC
# ================================================================
# Set to 'true' to start the embedded KDC server
# Set to 'false' to disable Kerberos functionality
# Default: false
kerberos.enabled=false

# ================================================================
# Kerberos Realm Configuration
# ================================================================
# The Kerberos realm name (UPPERCASE by convention)
# All principals will be in this realm (e.g., mluser1@MARKLOGIC.LOCAL)
# Default: MARKLOGIC.LOCAL
kerberos.realm=MARKLOGIC.LOCAL

# ================================================================
# KDC Network Configuration
# ================================================================
# KDC hostname (use 'localhost' for local testing)
# Default: localhost
kerberos.kdc.host=localhost

# KDC port for Kerberos protocol (AS and TGS requests)
# Standard KDC port is 88, but we use 60088 to avoid requiring root/admin
# Default: 60088
kerberos.kdc.port=60088

# Kadmin port for administrative operations
# Standard kadmin port is 749, but we use 60749 to avoid requiring root/admin
# Default: 60749
kerberos.admin.port=60749

# ================================================================
# Principal Management
# ================================================================
# Import user principals from the in-memory LDAP server
# When enabled, all users in the LDAP directory will be created as Kerberos principals
# Passwords will be synchronized from LDAP
# Default: true
kerberos.principals.import-from-ldap=true

# Base DN for LDAP principal import
# This should match the base DN of your in-memory LDAP server
# Default: dc=MarkLogic,dc=Local
kerberos.principals.ldap-base-dn=dc=MarkLogic,dc=Local

# ================================================================
# Service Principals
# ================================================================
# Comma-separated list of service principals to create
# Format: service/hostname (realm will be appended automatically)
#
# Common service types:
#   HTTP/hostname  - For web services (SPNEGO authentication)
#   ldap/hostname  - For LDAP services
#   host/hostname  - For general host services
#
# Note: These principals will be created with keytab files in the
#       kerberos/keytabs/ directory for service authentication
#
# Default: HTTP/localhost,ldap/localhost
kerberos.service-principals=HTTP/localhost,ldap/localhost

# ================================================================
# Working Directory
# ================================================================
# Directory where Kerberos files will be stored:
#   - krb5.conf (Kerberos client configuration)
#   - keytabs/ (Service principal keytab files)
#   - Backend database files
#
# Default: ./kerberos
kerberos.work-dir=./kerberos

# ================================================================
# Debug Configuration
# ================================================================
# Enable detailed debug logging for Kerberos operations
# Useful for troubleshooting authentication issues
# Default: false
kerberos.debug=false

# ================================================================
# Advanced Configuration (Optional)
# ================================================================

# Ticket lifetime (seconds)
# How long tickets remain valid after being issued
# Default: 36000 (10 hours)
#kerberos.ticket.lifetime=36000

# Renewable ticket lifetime (seconds)
# How long tickets can be renewed before requiring re-authentication
# Default: 604800 (7 days)
#kerberos.ticket.renewable-lifetime=604800

# Maximum ticket renewal time (seconds)
# Default: 604800 (7 days)
#kerberos.ticket.max-renewable-life=604800

# Clock skew tolerance (seconds)
# Maximum acceptable time difference between client and KDC
# Default: 300 (5 minutes)
#kerberos.clock-skew=300

# ================================================================
# Example: Enable Kerberos for Testing
# ================================================================
# To enable Kerberos KDC, uncomment the following:
#
# kerberos.enabled=true
#
# Then start MLEAProxy:
#   java -jar target/mlesproxy-2.0.0.jar
#
# Use the auto-generated krb5.conf:
#   export KRB5_CONFIG=./krb5.conf
#
# Get a Kerberos ticket:
#   kinit mluser1@MARKLOGIC.LOCAL
#   (password: password)
#
# Verify the ticket:
#   klist
#
# ================================================================
# Default Principals
# ================================================================
# When kerberos.principals.import-from-ldap=true, the following
# principals will be created from the in-memory LDAP server:
#
# User Principals:
#   mluser1@MARKLOGIC.LOCAL    (password: password)
#   mluser2@MARKLOGIC.LOCAL    (password: password)
#   mluser3@MARKLOGIC.LOCAL    (password: password)
#   appreader@MARKLOGIC.LOCAL  (password: password)
#   appwriter@MARKLOGIC.LOCAL  (password: password)
#   appadmin@MARKLOGIC.LOCAL   (password: password)
#
# Service Principals:
#   HTTP/localhost@MARKLOGIC.LOCAL
#   ldap/localhost@MARKLOGIC.LOCAL
#   krbtgt/MARKLOGIC.LOCAL@MARKLOGIC.LOCAL (auto-created)
#
# ================================================================
# Keytab Files
# ================================================================
# Service principal keytabs will be created in:
#   ./kerberos/keytabs/
#
# Files:
#   HTTP_localhost.keytab  - For HTTP/localhost@MARKLOGIC.LOCAL
#   ldap_localhost.keytab  - For ldap/localhost@MARKLOGIC.LOCAL
#
# Use these keytabs for service authentication:
#   kinit -kt ./kerberos/keytabs/HTTP_localhost.keytab HTTP/localhost@MARKLOGIC.LOCAL
#
# ================================================================
# krb5.conf Generation
# ================================================================
# MLEAProxy will automatically generate krb5.conf in:
#   ./krb5.conf (root directory)
#   ./kerberos/krb5.conf (work directory)
#
# The generated krb5.conf will contain:
#   - Realm configuration
#   - KDC location
#   - Domain realm mappings
#   - Localhost-optimized settings (no DNS lookups)
#
# Set environment variable to use it:
#   export KRB5_CONFIG=./krb5.conf
#
# ================================================================
# Troubleshooting
# ================================================================
#
# Issue: "Cannot find KDC for realm"
# Solution: Set KRB5_CONFIG environment variable:
#   export KRB5_CONFIG=./krb5.conf
#
# Issue: "Clock skew too great"
# Solution: Sync system time:
#   macOS:  sudo sntp -sS time.apple.com
#   Linux:  sudo ntpdate pool.ntp.org
#
# Issue: "Pre-authentication failed"
# Solution: Check password (default is "password" for all users)
#
# Issue: Port already in use
# Solution: Change kerberos.kdc.port to an available port:
#   kerberos.kdc.port=60089
#
# ================================================================
