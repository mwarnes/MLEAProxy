# MarkLogic External Security Configuration Instructions
# Generated for: ldapjson
# Description: Simple LDAP Server using JSON user store
# Created: 2025-10-31T12:01:48.438702

## Overview
This configuration creates an External Security object in MarkLogic that enables
LDAP authentication using the MLEAProxy service.

## Configuration Details
- **Configuration Name**: MLEAProxy-ldapjson
- **Authentication Method**: LDAP
- **LDAP Server URI**: ldap://localhost:20389
- **LDAP Base DN**: ou=users,dc=marklogic,dc=local
- **LDAP Attribute**: sAMAccountName
- **Authorization**: LDAP (roles from LDAP groups)
- **Cache Timeout**: 300 seconds

## Files Generated
- **Configuration File**: marklogic-external-security-ldapjson.json
- **Instructions File**: marklogic-external-security-ldapjson-instructions.txt (this file)

## Step-by-Step Setup Instructions

### Step 1: Verify MarkLogic Management Interface Access
Ensure you can access the MarkLogic Management API. Test with:
```bash
curl -X GET --anyauth -u admin:admin http://localhost:8002/manage/v2/external-security
```

### Step 2: Apply the External Security Configuration
Use the following curl command to create the external security configuration:
```bash
curl -X POST --anyauth -u admin:admin -H "Content-Type:application/json" -d @marklogic-external-security-ldapjson.json http://localhost:8002/manage/v2/external-security
```

### Step 3: Verify Configuration was Created
Check that the configuration was created successfully:
```bash
curl -X GET --anyauth -u admin:admin http://localhost:8002/manage/v2/external-security/MLEAProxy-ldapjson
```

### Step 4: Assign External Security to App Server
1. Open MarkLogic Admin UI (http://localhost:8001)
2. Navigate to Groups > Default > App Servers > [Your App Server]
3. Set "external security" to "MLEAProxy-ldapjson"
4. Click "ok" to save

Alternatively, use the Management API:
```bash
# Get current app server configuration
curl -X GET --anyauth -u admin:admin \
  http://localhost:8002/manage/v2/servers/[server-name]/properties

# Update app server with external security (modify the JSON response above)
curl -X PUT --anyauth -u admin:admin \
  -H "Content-Type:application/json" \
  -d @updated-server-config.json \
  http://localhost:8002/manage/v2/servers/[server-name]/properties
```

## Testing the Configuration

### Test LDAP Authentication
Once configured, test authentication with:
```bash
# Replace with your MarkLogic app server URL and port
curl -X GET -u [ldap-username]:[ldap-password] \
  http://localhost:8000/v1/config/security
```

### Troubleshooting

1. **Check MarkLogic Error Logs**:
   - Location: MarkLogic installation/Logs/
   - Look for authentication and LDAP-related errors

2. **Verify LDAP Server Connectivity**:
   ```bash
   # Test LDAP connection from MarkLogic server
   ldapsearch -H ldap://localhost:20389 -D "[bind-dn]" -w "[password]" -b "ou=users,dc=marklogic,dc=local" "(uid=testuser)"
   ```

3. **Check External Security Status**:
   ```bash
   curl -X GET --anyauth -u admin:admin \
     http://localhost:8002/manage/v2/external-security/MLEAProxy-ldapjson/properties
   ```

## Configuration JSON Content
The generated configuration file (marklogic-external-security-ldapjson.json) contains:
```json
{
  "external-security-name": "MLEAProxy-ldapjson",
  "description": "Simple LDAP Server using JSON user store",
  "authentication": "ldap",
  "cache-timeout": "300",
  "authorization": "ldap",
  "ldap-server-uri": "ldap://localhost:20389",
  "ldap-base": "ou=users,dc=marklogic,dc=local",
  "ldap-attribute": "sAMAccountName",
  "ldap-default-user": "default",
  "ldap-password": "password",
  "ldap-bind-method": "simple"
}
```

## Important Notes

1. **Security Considerations**:
   - Change default credentials in production
   - Use LDAPS (SSL/TLS) for production environments
   - Implement proper LDAP bind user with minimal privileges

2. **Performance**:
   - Cache timeout (300s) can be adjusted based on requirements
   - Monitor LDAP server performance under load

3. **High Availability**:
   - Configure multiple LDAP servers in the URI for failover
   - Example: "ldap://server1:389 ldap://server2:389"

## Support
- MLEAProxy Documentation: Check README.md and docs/ directory
- MarkLogic Documentation: https://docs.marklogic.com/
- LDAP Troubleshooting: Check logs and connection parameters

Generated by MLEAProxy v2.0
